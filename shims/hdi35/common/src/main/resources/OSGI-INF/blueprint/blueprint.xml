<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="
            http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd">

  <bean id="hdi35Hadoop" class="org.pentaho.hadoop.shim.hdi35.HadoopShim" scope="singleton"/>
  <service ref="hdi35Hadoop" interface="org.pentaho.hadoop.shim.spi.HadoopShim">
    <service-properties>
      <entry key="shim">
        <value type="java.lang.String">hdi35</value>
      </entry>
    </service-properties>
  </service>

  <bean id="hadoopFileSystem" class="com.pentaho.big.data.bundles.impl.shim.hdfs.HadoopFileSystemFactoryImpl">
    <argument ref="hdi35Hadoop"/>
  </bean>

  <service ref="hadoopFileSystem" interface="org.pentaho.bigdata.api.hdfs.HadoopFileSystemFactory"/>

  <bean id="hdi35SqoopShim" class="org.pentaho.hadoop.shim.common.sqoop.CommonSqoopShim">
    <property name="bundleContext" ref="blueprintBundleContext" />
  </bean>

  <service ref="hdi35SqoopShim" auto-export="interfaces">
    <service-properties>
      <entry key="shim">
        <value type="java.lang.String">hdi35</value>
      </entry>
      <entry key="service">
        <value type="java.lang.String">sqoop</value>
      </entry>
    </service-properties>
  </service>

  <bean id="hdi35SqoopServiceFactory" class="org.pentaho.big.data.impl.shim.sqoop.SqoopServiceFactoryImpl">
    <argument ref="hdi35Hadoop"/>
    <argument ref="hdi35SqoopShim"/>
  </bean>

  <service ref="hdi35SqoopServiceFactory"
           interface="org.pentaho.big.data.api.cluster.service.locator.NamedClusterServiceFactory">
    <service-properties>
      <entry key="shim">
        <value type="java.lang.String">hdi35</value>
      </entry>
      <entry key="service">
        <value type="java.lang.String">sqoop</value>
      </entry>
    </service-properties>
  </service>


  <bean id="hdi35PigShim" class="org.pentaho.hadoop.shim.common.pig.PigShimImpl">
    <property name="bundleContext" ref="blueprintBundleContext"/>
  </bean>

  <service ref="hdi35PigShim" auto-export="interfaces">
    <service-properties>
      <entry key="shim">
        <value type="java.lang.String">hdi35</value>
      </entry>
      <entry key="service">
        <value type="java.lang.String">pig</value>
      </entry>
    </service-properties>
  </service>

  <bean id="hdi35PigServiceFactory" class="org.pentaho.big.data.impl.shim.pig.PigServiceFactoryImpl">
    <argument ref="hdi35Hadoop"/>
    <argument ref="hdi35PigShim"/>
  </bean>

  <service ref="hdi35PigServiceFactory"
           interface="org.pentaho.big.data.api.cluster.service.locator.NamedClusterServiceFactory">
    <service-properties>
      <entry key="shim">
        <value type="java.lang.String">hdi35</value>
      </entry>
      <entry key="service">
        <value type="java.lang.String">pig</value>
      </entry>
    </service-properties>
  </service>

  <bean id="hdi35FormatShim" class="org.pentaho.hadoop.shim.common.CommonFormatShim"/>

  <service ref="hdi35FormatShim" auto-export="interfaces">
    <service-properties>
      <entry key="shim">
        <value type="java.lang.String">hdi35</value>
      </entry>
      <entry key="service">
        <value type="java.lang.String">format</value>
      </entry>
    </service-properties>
  </service>

  <bean id="hdi35FormatServiceFactory" class="org.pentaho.big.data.impl.shim.format.FormatServiceFactory">
    <argument ref="hdi35FormatShim"/>
  </bean>

  <service ref="hdi35FormatServiceFactory"
           interface="org.pentaho.big.data.api.cluster.service.locator.NamedClusterServiceFactory">
    <service-properties>
      <entry key="shim">
        <value type="java.lang.String">hdi35</value>
      </entry>
      <entry key="service">
        <value type="java.lang.String">format</value>
      </entry>
    </service-properties>
  </service>

  <bean id="hdi35MapReduceServiceFactory" class="org.pentaho.big.data.impl.shim.mapreduce.MapReduceServiceFactoryImpl">
    <argument ref="hdi35Hadoop"/>
    <argument ref="executorService"/>
    <argument ref="transformationVisitorList"/>
  </bean>
  <reference id="executorService" interface="java.util.concurrent.ExecutorService"/>

  <service ref="hdi35MapReduceServiceFactory" interface="org.pentaho.big.data.api.cluster.service.locator.NamedClusterServiceFactory">
    <service-properties>
      <entry key="shim">
        <value type="java.lang.String">hdi35</value>
      </entry>
      <entry key="service">
        <value type="java.lang.String">mapreduce</value>
      </entry>
    </service-properties>
  </service>
  <reference-list id="transformationVisitorList" interface="org.pentaho.bigdata.api.mapreduce.TransformationVisitorService"
                  availability="optional"/>
  <!--<reference id="hdi35HadoopConfiguration" interface="org.pentaho.hadoop.shim.api.HadoopConfigurationInterface"/>-->

</blueprint>
